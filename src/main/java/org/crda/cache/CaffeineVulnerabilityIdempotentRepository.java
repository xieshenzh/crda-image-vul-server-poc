package org.crda.cache;

import com.github.benmanes.caffeine.cache.Caffeine;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import org.crda.vulnerability.VulnerabilityIdempotentRepository;
import org.eclipse.microprofile.config.inject.ConfigProperty;

import java.util.concurrent.TimeUnit;

@ApplicationScoped
public class CaffeineVulnerabilityIdempotentRepository extends CaffeineIdempotentRepository implements VulnerabilityIdempotentRepository {

    @ConfigProperty(name = "camel.component.caffeine-cache.expire-after-write-time", defaultValue = "300")
    long expireAfterWriteTime;

    @ConfigProperty(name = "camel.component.caffeine-cache.expire-after-access-time", defaultValue = "300")
    long expireAfterAccessTime;

    @Inject
    public CaffeineVulnerabilityIdempotentRepository(@ConfigProperty(name = "caffeine-cache.vulnerability-idempotent-repository-name", defaultValue = "vulsIdem") String cacheName) {
        super(cacheName);
    }

    @Override
    Caffeine<Object, Object> getCacheBuilder() {
        return Caffeine.newBuilder()
                .expireAfterWrite(expireAfterWriteTime, TimeUnit.SECONDS)
                .expireAfterAccess(expireAfterAccessTime, TimeUnit.SECONDS);
    }
}
